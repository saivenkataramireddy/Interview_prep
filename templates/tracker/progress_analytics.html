{% extends "tracker/base.html" %}
{% load static %}

{% block content %}
<style>
:root{
  --accent:#ffd166;
  --accent-2:#ff9a5c;
  --muted:#9aa7bd;
  --glass: rgba(255,255,255,0.035);
  --card-radius:14px;
  --card-bg: linear-gradient(180deg, rgba(255,255,255,0.012), rgba(255,255,255,0.01));
}

/* container */
.analytics-wrap{
  max-width:1100px;
  margin:28px auto;
  padding:18px;
}

/* header */
.page-head{
  text-align:center;
  margin-bottom:18px;
}
.page-head h3{
  margin:0;
  color:#fff;
  font-weight:800;
  letter-spacing:-0.3px;
}

/* grid */
.grid-analytics{
  display:grid;
  grid-template-columns: repeat(2, 1fr);
  gap:18px;
  align-items:stretch;
}

/* glass card */
.chart-card{
  border-radius:var(--card-radius);
  padding:18px;
  background: var(--card-bg);
  border:1px solid rgba(255,255,255,0.04);
  box-shadow: 0 20px 50px rgba(0,0,0,0.55);
  color:#fff;
}

/* chart title */
.chart-card h5{
  margin:0 0 10px 0;
  font-weight:800;
  color:#fff;
}

/* suggestion */
.suggestion {
  margin-top:16px;
  text-align:center;
  font-weight:700;
  color:#fff;
}

/* back button */
.back-row{
  text-align:center;
  margin-top:18px;
}

/* small meta */
.small-muted{
  color:var(--muted);
  font-size:0.95rem;
  margin-top:6px;
}

@media (max-width: 900px){
  .grid-analytics{ grid-template-columns: 1fr; }
}
</style>

<div class="analytics-wrap">

  <div class="page-head">
    <h3>ðŸ“Š Your Progress Analytics</h3>
    <div class="small-muted">Visual summary of completed vs pending problems and category-level progress.</div>
  </div>

  <div class="grid-analytics">
    <!-- PIE CHART -->
    <div class="chart-card">
      <h5 class="text-center">Overall Completion</h5>
      <canvas id="overallPieChart"></canvas>
    </div>

    <!-- BAR CHART -->
    <div class="chart-card">
      <h5 class="text-center">Category Progress</h5>
      <canvas id="categoryBarChart"></canvas>
    </div>
  </div>

  {% if weak_topic %}
  <div class="chart-card suggestion">
    Suggestion: Focus more on <span style="color:#ff9a5c">{{ weak_topic }}</span>.
  </div>
  {% endif %}

  <div class="back-row">
    <a href="{% url 'dashboard' %}" class="btn" style="background:linear-gradient(90deg,var(--accent),var(--accent-2)); color:#07101a; font-weight:800; padding:10px 16px; border-radius:10px;">
      â¬… Back to Dashboard
    </a>
  </div>
</div>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<script>
/* Data from Django */
const analyticsData = {{ analytics|safe }};
const completed = {{ total_completed }};
const pending = {{ total_pending }};

const labels = analyticsData.map(a => a.category);
const completedData = analyticsData.map(a => a.completed);
const pendingData = analyticsData.map(a => a.pending);

/* ---------- NEW PIE CHART COLORS ---------- */
const pieColors = [
  "#4ade80",  // Completed = Green
  "#f87171"   // Pending = Red
];

/* ---------- PIE CHART ---------- */
new Chart(document.getElementById("overallPieChart"), {
  type: 'pie',
  data: {
    labels: ['Completed', 'Pending'],
    datasets: [{
      data: [completed, pending],
      backgroundColor: pieColors,
      borderWidth: 0
    }]
  },
  options: {
    responsive: true,
    plugins: {
      legend: { position: 'bottom', labels: { color:'#fff' } }
    }
  }
});

/* ---------- BAR CHART ---------- */
new Chart(document.getElementById("categoryBarChart"), {
  type: 'bar',
  data: {
    labels: labels,
    datasets: [
      {
        label: 'Completed',
        data: completedData,
        backgroundColor: "#4ade80",
        borderRadius: 6
      },
      {
        label: 'Pending',
        data: pendingData,
        backgroundColor: "#f87171",
        borderRadius: 6
      }
    ]
  },
  options: {
    responsive: true,
    scales: {
      x: { ticks: { color: '#fff' }, grid: { display:false }},
      y: { ticks: { color: '#fff' }, grid: { color:'rgba(255,255,255,0.08)' }}
    },
    plugins: {
      legend: { labels: { color:'#fff' } }
    }
  }
});
</script>

{% endblock %}